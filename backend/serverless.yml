service:
  name: serverless-todo-app

plugins:
  - serverless-webpack
  - serverless-iam-roles-per-function

provider:
  name: aws
  runtime: nodejs12.x

  stage: ${opt:stage, 'dev'}
  region: ${opt:region, 'us-east-1'}

  environment:
    RSA256CERT: |
      -----BEGIN CERTIFICATE-----
      MIIDCTCCAfGgAwIBAgIJLz28is2wJ1v0MA0GCSqGSIb3DQEBCwUAMCIxIDAeBgNV
      BAMTF2Rldi1tdXR0YWxlYm0uYXV0aDAuY29tMB4XDTIwMDMxNzE2MTMzN1oXDTMz
      MTEyNDE2MTMzN1owIjEgMB4GA1UEAxMXZGV2LW11dHRhbGVibS5hdXRoMC5jb20w
      ggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDKO1CBo6+4ouFYQb7IMM5L
      N75M+6glUR44q8nwKouxvj+4yMw9N4VBUdKwxjTNQw/FaG/L5aDRXjwMVSMm3c/V
      7xnowJnXaCu9t4AGvTQAmJRU3RQdIYPXR8Ix9iDvVqou8JKHQmUe5jOZ35K/SyVL
      gwprBQog1hTF+yyPxnfPrxXmLyowwQdNFD+QP2BNJjRxKHBaa5x3tdCjsSn+JLQP
      Y4d9tRRS54z1nod26Yw1a0zp3pGrQLiHIsVeRLnLQWhi9wcOfMbvS+BskdOCnO0F
      dbqPA07hzyOPC3nZISnmglVTxpfVjZrlTkUTOWuM2lo5/Sh6GSr0528wVFBt7hrt
      AgMBAAGjQjBAMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFDy/VM537jmUb9Ta
      mLBmTBPLNluPMA4GA1UdDwEB/wQEAwIChDANBgkqhkiG9w0BAQsFAAOCAQEAY7MI
      1+d0V/C0F3wYYr8tBNs8XFPI/liREHHj8YvgYZI92R1N4Dp+6ibSm/3ezWBjOzZb
      3VPGPy1IKAn1IHUIaoqcD8GXWTmySMXXcXHomPAnT50h9m0kbrrpBl/cgD6HuEtU
      Nx0Bxm3kwTOhWJ5tGh6de4mZR40P3aej6A7oW+Tarw3/c+xFQImSECtclyek3i2D
      P53lgwdF/rM87vxil35rzJQfEbOn/WoGZ6vx1gLayIR5a+HEiUQAhNI3NjgI3JLH
      YzI4i0HCfdI4mUGfm8rVfVxDwqQvljIn1XbllOV3ewVJOrwhT+JJL5kudv6LUn56
      B3hhtzoEv3qlg3l9VA==
      -----END CERTIFICATE-----


functions:

  RS256Auth:
    handler: src/lambda/auth/rs256Auth0Authorizer.handler

  Auth:
    handler: src/lambda/auth/auth0Authorizer.handler

  # TODO: Configure this function
  GetTodos:
    handler: src/lambda/http/getTodos.handler
    events:
      - http:
          method: get
          path: todos

  # TODO: Configure this function
  CreateTodo:
    handler: src/lambda/http/createTodo.handler
    events:
      - http:
          method: post
          path: todos

  # TODO: Configure this function
  UpdateTodo:
    handler: src/lambda/http/updateTodo.handler
    events:
      - http:
          method: patch
          path: todos/{todoId}

  # TODO: Configure this function
  DeleteTodo:
    handler: src/lambda/http/deleteTodo.handler
    events:
      - http:
          method: delete
          path: todos/{todoId}

  # TODO: Configure this function
  GenerateUploadUrl:
    handler: src/lambda/http/generateUploadUrl.handler
    events:
      - http:
          method: post
          path: todos/{todoId}/attachment

resources:
  Resources:
    # TODO: Add any necessary AWS resources